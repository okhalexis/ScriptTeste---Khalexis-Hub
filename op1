--[[
    KLS HUB - UFO EVENT & PHYSICS TESTER
    Author: KLS Senior Dev
    Target: Security Audit / Event Farm Testing
]]

-- 1. Carregar Library
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- 2. Serviços Essenciais
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- 3. Variáveis de Controle
local Config = {
    Speed = {
        Enabled = false,
        Value = 16, -- Velocidade padrão
    },
    Event = {
        TargetName = "NomeDoItemAqui", -- Nome do item do OVNI
        MagnetEnabled = false,
        TeleportEnabled = false,
        Distance = 500, -- Raio de busca
    }
}

local Connections = {} -- Gerenciador de memória

-- 4. Criação da Janela
WindUI:SetNotificationLower(true)
local Window = WindUI:CreateWindow({
    Title = "KLS: Event Security Test",
    Icon = "gamepad-2",
    Author = "Dev Admin",
    Folder = "KLSEventTest",
    Size = UDim2.fromOffset(600, 450),
    Transparent = true,
    Theme = "Dark",
})

local TabMovement = Window:Tab({ Title = "Física (Speed)", Icon = "wind" })
local TabEvent = Window:Tab({ Title = "Evento OVNI", Icon = "ufo" }) -- Ícone ilustrativo
local TabSettings = Window:Tab({ Title = "Config", Icon = "settings" })

-- ==========================================
-- LÓGICA: SPEED BYPASS (VELOCITY)
-- ==========================================
-- Este método engana Anti-Cheats que olham apenas para Humanoid.WalkSpeed
local function UpdateSpeed()
    if not Config.Speed.Enabled then return end
    
    local Char = LocalPlayer.Character
    if Char and Char:FindFirstChild("Humanoid") and Char:FindFirstChild("HumanoidRootPart") then
        local Hum = Char.Humanoid
        local Root = Char.HumanoidRootPart
        
        -- Só aplica se o jogador estiver tentando andar
        if Hum.MoveDirection.Magnitude > 0 then
            -- Sobrescreve a velocidade linear mantendo a gravidade (Y)
            Root.AssemblyLinearVelocity = Vector3.new(
                Hum.MoveDirection.X * Config.Speed.Value,
                Root.AssemblyLinearVelocity.Y,
                Hum.MoveDirection.Z * Config.Speed.Value
            )
        end
    end
end

TabMovement:Section({ Title = "Velocity Manipulation" })

TabMovement:Slider({
    Title = "Velocidade Real (Bypass)",
    Desc = "Define a velocidade física, ignorando a propriedade WalkSpeed.",
    Step = 1,
    Value = { Min = 16, Max = 300, Default = 16 },
    Callback = function(v)
        Config.Speed.Value = v
    end
})

TabMovement:Toggle({
    Title = "Ativar Speed",
    Desc = "Habilita o override de física.",
    Value = false,
    Callback = function(state)
        Config.Speed.Enabled = state
        if state then
            -- Heartbeat roda após a física, garantindo que nosso valor prevaleça
            Connections["SpeedLoop"] = RunService.Heartbeat:Connect(UpdateSpeed)
        else
            if Connections["SpeedLoop"] then Connections["SpeedLoop"]:Disconnect() end
        end
    end
})

-- ==========================================
-- LÓGICA: EVENTO OVNI (MAGNET & TP)
-- ==========================================
-- Função para puxar objetos (Magnet) ou ir até eles
local function ProcessEventItems()
    local Char = LocalPlayer.Character
    if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
    
    local Root = Char.HumanoidRootPart
    
    -- Busca global no Workspace ou numa pasta específica de drops
    for _, item in pairs(Workspace:GetDescendants()) do
        -- Verifica se o nome bate com o configurado (insensível a maiúsculas/minúsculas)
        if item:IsA("BasePart") and string.find(string.lower(item.Name), string.lower(Config.Event.TargetName)) then
            
            -- Verifica distância para não quebrar o jogo puxando o mapa todo
            local dist = (item.Position - Root.Position).Magnitude
            if dist <= Config.Event.Distance then
                
                -- MODO 1: MAGNET (Traz o item até você)
                -- Nota técnica: Isso só funciona se o item não estiver ANCHORED ou se você tiver NetworkOwnership
                if Config.Event.MagnetEnabled then
                    if item.Anchored == false then
                        item.CFrame = Root.CFrame * CFrame.new(0, 0, -3) -- Traz para frente do player
                        item.AssemblyLinearVelocity = Vector3.zero -- Para o item não sair voando
                    else
                        -- Se for ancorado, tentamos simular o toque (FireTouchInterest) se o executor suportar
                        firetouchinterest(Root, item, 0) -- Touch
                        task.wait()
                        firetouchinterest(Root, item, 1) -- Untouch
                    end
                end

                -- MODO 2: TELEPORT FARM (Vai até o item)
                -- Mais agressivo, detectável se o AC verificar distância/tempo
                if Config.Event.TeleportEnabled then
                    Root.CFrame = item.CFrame * CFrame.new(0, 2, 0) -- Vai para cima do item
                end
            end
        elseif item:IsA("Model") and string.find(string.lower(item.Name), string.lower(Config.Event.TargetName)) then
            -- Suporte caso o drop seja um Model e não uma Part solta (pega a PrimaryPart)
            if item.PrimaryPart then
                local part = item.PrimaryPart
                 if Config.Event.TeleportEnabled then
                    Root.CFrame = part.CFrame
                end
            end
        end
    end
end

TabEvent:Section({ Title = "Configuração do Coletor" })

TabEvent:Input({
    Title = "Nome do Item (Target)",
    Desc = "Digite parte do nome do drop do OVNI (ex: Coin, Ore, Gift)",
    Default = "Coin",
    Placeholder = "Nome do objeto...",
    Callback = function(text)
        Config.Event.TargetName = text
        WindUI:Notify({ Title = "Alvo Definido", Content = "Buscando por: " .. text, Icon = "search" })
    end
})

TabEvent:Slider({
    Title = "Raio de Busca",
    Desc = "Distância máxima para interagir",
    Step = 10,
    Value = { Min = 50, Max = 2000, Default = 500 },
    Callback = function(v)
        Config.Event.Distance = v
    end
})

TabEvent:Section({ Title = "Métodos de Coleta" })

TabEvent:Toggle({
    Title = "Magnet Mode (Puxar Itens)",
    Desc = "Traz os itens até você (Requer item solto/unanchored)",
    Value = false,
    Callback = function(state)
        Config.Event.MagnetEnabled = state
        Config.Event.TeleportEnabled = false -- Segurança: desativa o outro modo
        
        if state then
            Connections["EventLoop"] = RunService.RenderStepped:Connect(ProcessEventItems)
        else
            if not Config.Event.TeleportEnabled and Connections["EventLoop"] then 
                Connections["EventLoop"]:Disconnect() 
            end
        end
    end
})

TabEvent:Toggle({
    Title = "Teleport Mode (Ir até Item)",
    Desc = "Teleporta você para cada item encontrado",
    Value = false,
    Callback = function(state)
        Config.Event.TeleportEnabled = state
        Config.Event.MagnetEnabled = false -- Segurança: desativa o outro modo
        
        if state then
            Connections["EventLoop"] = RunService.RenderStepped:Connect(ProcessEventItems)
        else
            if not Config.Event.MagnetEnabled and Connections["EventLoop"] then 
                Connections["EventLoop"]:Disconnect() 
            end
        end
    end
})

-- ==========================================
-- CONFIG E CLEANUP
-- ==========================================
TabSettings:Section({ Title = "UI" })
TabSettings:Button({
    Title = "Destruir Script",
    Desc = "Limpa conexões e fecha a UI",
    Callback = function()
        for _, conn in pairs(Connections) do
            if conn then conn:Disconnect() end
        end
        Window:Close()
    end
})

-- Inicialização
WindUI:Notify({
    Title = "KLS Event Tester",
    Content = "Script injetado. Configure o nome do item na aba Evento.",
    Duration = 6,
    Icon = "shield-alert",
})
