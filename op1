--[[
    KLS HUB - BRAINROT TYCOON AUDIT
    Alvo: Teste de Física e Interação de Eventos
    Criado com base no Dump do Jogo fornecido.
]]

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer

-- ==========================================
-- VARIÁVEIS E FUNÇÕES AUXILIARES
-- ==========================================
local Flags = {
    Speed = 16,
    SpeedEnabled = false,
    MagnetDrops = false,
    AutoLuckyBlock = false,
    AutoCollectCash = false,
    RemoveLava = false,
    MyTycoon = nil -- Vai detectar automaticamente
}

local Connections = {}

-- Função Segura para Tocar em Partes (Simula TouchInterest)
local function FireTouch(part)
    if not part then return end
    local Char = LocalPlayer.Character
    if Char and Char:FindFirstChild("HumanoidRootPart") then
        firetouchinterest(Char.HumanoidRootPart, part, 0) -- Toca
        task.wait()
        firetouchinterest(Char.HumanoidRootPart, part, 1) -- Solta
    end
end

-- Tenta encontrar o Tycoon do jogador
local function GetMyTycoon()
    for _, base in pairs(Workspace.Bases:GetChildren()) do
        -- Geralmente o nome do dono fica numa StringValue ou no Texto da Placa
        -- Vou procurar pelo nome do jogador na placa da base
        local sign = base:FindFirstChild("Title") or base:FindFirstChild("Sign")
        if sign then
            local textLabel = sign:FindFirstChild("TextLabel", true) or sign:FindFirstChild("PlayerName", true)
            if textLabel and string.find(textLabel.Text, LocalPlayer.Name) then
                return base
            end
        end
    end
    return nil
end

-- ==========================================
-- UI SETUP
-- ==========================================
WindUI:SetNotificationLower(true)
local Window = WindUI:CreateWindow({
    Title = "KLS: Brainrot Tycoon Test",
    Icon = "brain-circuit",
    Author = "KLS Team",
    Folder = "KLSTycoon",
    Size = UDim2.fromOffset(600, 450),
    Transparent = true,
    Theme = "Dark",
})

local TabFarm = Window:Tab({ Title = "Tycoon & Farm", Icon = "coins" })
local TabEvent = Window:Tab({ Title = "Eventos & Drops", Icon = "zap" })
local TabPlayer = Window:Tab({ Title = "Player (Física)", Icon = "user" })

-- ==========================================
-- ABA: TYCOON FARM
-- ==========================================
TabFarm:Section({ Title = "Automação da Base" })

TabFarm:Button({
    Title = "Detectar Minha Base",
    Desc = "Clica aqui se o Auto Farm não funcionar",
    Callback = function()
        Flags.MyTycoon = GetMyTycoon()
        if Flags.MyTycoon then
            WindUI:Notify({ Title = "Sucesso", Content = "Base encontrada: " .. Flags.MyTycoon.Name, Icon = "check" })
        else
            WindUI:Notify({ Title = "Erro", Content = "Não encontrei sua base. Reivindique uma primeiro!", Icon = "alert-triangle" })
        end
    end
})

TabFarm:Toggle({
    Title = "Auto Collect Cash",
    Desc = "Coleta dinheiro dos coletores automaticamente (TouchInterest)",
    Callback = function(state)
        Flags.AutoCollectCash = state
        if state then
            task.spawn(function()
                while Flags.AutoCollectCash do
                    if not Flags.MyTycoon then Flags.MyTycoon = GetMyTycoon() end
                    
                    if Flags.MyTycoon then
                        -- Vasculha os Slots da base por 'CollectMoneyGui' ou pads de coleta
                        local slots = Flags.MyTycoon:FindFirstChild("Slots")
                        if slots then
                            for _, slot in pairs(slots:GetChildren()) do
                                local collectPart = slot:FindFirstChild("Collect")
                                if collectPart then
                                    FireTouch(collectPart)
                                end
                            end
                        end
                    end
                    task.wait(1) -- Coleta a cada 1 segundo
                end
            end)
        end
    end
})

-- ==========================================
-- ABA: EVENTOS & DROPS (O PEDIDO PRINCIPAL)
-- ==========================================
TabEvent:Section({ Title = "Chuva de Itens (Tsunami/UFO)" })

TabEvent:Toggle({
    Title = "Magnet Event Drops",
    Desc = "Puxa as moedas do Tsunami/UFO (WaveCoinDrops)",
    Callback = function(state)
        Flags.MagnetDrops = state
        if state then
            Connections["MagnetLoop"] = RunService.Heartbeat:Connect(function()
                local Char = LocalPlayer.Character
                if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
                local Root = Char.HumanoidRootPart

                -- Puxa da pasta WaveCoinDrops (baseado no seu dump)
                if Workspace:FindFirstChild("WaveCoinDrops") then
                    for _, drop in pairs(Workspace.WaveCoinDrops:GetChildren()) do
                        if drop:IsA("BasePart") and drop.Anchored == false then
                            -- Traz fisicamente para o jogador
                            drop.CFrame = Root.CFrame
                            drop.AssemblyLinearVelocity = Vector3.new(0,0,0)
                        end
                    end
                end
                
                -- Puxa moedas de bomba se houver
                if Workspace:FindFirstChild("CoinBombs") then
                     for _, bomb in pairs(Workspace.CoinBombs:GetChildren()) do
                        if bomb:IsA("BasePart") then
                             bomb.CFrame = Root.CFrame
                        end
                     end
                end
            end)
        else
            if Connections["MagnetLoop"] then Connections["MagnetLoop"]:Disconnect() end
        end
    end
})

TabEvent:Section({ Title = "Lucky Blocks & Brainrots" })

TabEvent:Toggle({
    Title = "Auto Break Lucky Blocks",
    Desc = "Teleporta e interage com Lucky Blocks ativos (Celestial, Cosmic, etc)",
    Callback = function(state)
        Flags.AutoLuckyBlock = state
        if state then
            task.spawn(function()
                while Flags.AutoLuckyBlock do
                    local Char = LocalPlayer.Character
                    if Char and Char:FindFirstChild("HumanoidRootPart") and Workspace:FindFirstChild("ActiveLuckyBlocks") then
                        for _, block in pairs(Workspace.ActiveLuckyBlocks:GetChildren()) do
                            local root = block:FindFirstChild("RootPart")
                            if root then
                                -- Teleporta perto (teste de AC: Teleporte curto)
                                Char.HumanoidRootPart.CFrame = root.CFrame * CFrame.new(0, 3, 0)
                                task.wait(0.1)
                                
                                -- Tenta acionar o ProximityPrompt
                                local prompt = root:FindFirstChild("ProximityPrompt")
                                if prompt then
                                    fireproximityprompt(prompt)
                                end
                            end
                        end
                    end
                    task.wait(0.5)
                end
            end)
        end
    end
})

-- ==========================================
-- ABA: PLAYER (BYPASS REAL)
-- ==========================================
TabPlayer:Section({ Title = "Movimentação Bypass" })

TabPlayer:Slider({
    Title = "Velocity Speed",
    Desc = "Velocidade que ignora Humanoid.WalkSpeed",
    Step = 1,
    Value = { Min = 16, Max = 200, Default = 16 },
    Callback = function(v)
        Flags.Speed = v
    end
})

TabPlayer:Toggle({
    Title = "Ativar Speed",
    Callback = function(state)
        Flags.SpeedEnabled = state
        if state then
            Connections["SpeedBypass"] = RunService.Heartbeat:Connect(function()
                local Char = LocalPlayer.Character
                if Char and Char:FindFirstChild("Humanoid") and Char:FindFirstChild("HumanoidRootPart") then
                    local Hum = Char.Humanoid
                    local Root = Char.HumanoidRootPart
                    if Hum.MoveDirection.Magnitude > 0 then
                        Root.AssemblyLinearVelocity = Vector3.new(
                            Hum.MoveDirection.X * Flags.Speed,
                            Root.AssemblyLinearVelocity.Y,
                            Hum.MoveDirection.Z * Flags.Speed
                        )
                    end
                end
            end)
        else
            if Connections["SpeedBypass"] then Connections["SpeedBypass"]:Disconnect() end
        end
    end
})

TabPlayer:Section({ Title = "Segurança / Visual" })

TabPlayer:Button({
    Title = "Remover Lava",
    Desc = "Deleta a pasta Workspace.Lava para não morrer",
    Icon = "trash",
    Callback = function()
        if Workspace:FindFirstChild("Lava") then
            Workspace.Lava:Destroy()
            WindUI:Notify({ Title = "Lava Removida", Content = "Você não toma mais dano de lava.", Icon = "flame" })
        else
            WindUI:Notify({ Title = "Aviso", Content = "Lava não encontrada ou já removida.", Icon = "info" })
        end
    end
})

-- Notificação Inicial
WindUI:Notify({
    Title = "Script Carregado",
    Content = "KLS Brainrot Edition Ativado. Use a aba Farm para configurar sua base.",
    Duration = 5,
    Icon = "check",
})
