--[[
    NEXUS PRIME - PROFESSIONAL EDITION
    Desenvolvido por: Chief Script Architect (15 anos de exp.)
    Target: Roblox Engine v.2024
    UI Framework: WindUI
]]

--------------------------------------------------------------------------------
-- // 1. SERVIÇOS E VARIÁVEIS GLOBAIS
--------------------------------------------------------------------------------
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Localização das Propriedades do Jogo
local GapsContainer = Workspace:WaitForChild("DefaultMap"):WaitForChild("Gaps")
local VIPWalls = Workspace:WaitForChild("VIPWalls")
local AllowedSpaces = Workspace:WaitForChild("AllowedSpaces")

--------------------------------------------------------------------------------
-- // 2. LÓGICA DE ESTADO (ENGINE)
--------------------------------------------------------------------------------
local State = {
    Speed = 16,
    Jump = 50,
    FlyEnabled = false,
    FlySpeed = 50,
    AutoGap = false,
    SafetyProtocol = true,
    CurrentFlyVelocity = Vector3.zero
}

-- [ SISTEMA DE VOO ELITE ]
local function HandleFlight()
    RunService.Heartbeat:Connect(function()
        if State.FlyEnabled and Character and RootPart then
            local moveDir = Humanoid.MoveDirection
            local camera = Workspace.CurrentCamera
            local flyVec = Vector3.zero
            
            if moveDir.Magnitude > 0 then
                flyVec = moveDir * State.FlySpeed
            end
            
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                flyVec = flyVec + Vector3.new(0, State.FlySpeed, 0)
            elseif UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                flyVec = flyVec + Vector3.new(0, -State.FlySpeed, 0)
            end
            
            RootPart.Velocity = flyVec
            -- Mantém o player estabilizado no ar
            if flyVec == Vector3.zero then
                RootPart.Velocity = Vector3.new(0, 0, 0)
            end
        end
    end)
end

-- [ CÁLCULO DE SEGURANÇA DE WAVE ]
local function IsSafeToTeleport(targetPos)
    if not State.SafetyProtocol then return true end
    
    -- Analisa se há partes ativas em Waves1 ou Waves2 que podem interceptar o player
    for _, waveFolder in pairs({AllowedSpaces.Waves1, AllowedSpaces.Waves2}) do
        for _, obj in pairs(waveFolder:GetDescendants()) do
            if obj:IsA("BasePart") and obj.Transparency < 1 then
                -- Se a distância entre o objeto mortal e o destino for curta, aborta
                local dist = (obj.Position - targetPos).Magnitude
                if dist < 15 then return false end
            end
        end
    end
    return true
end

-- [ SISTEMA DE DESLOCAMENTO FLUTUANTE (GLIDE) ]
local function GlideToGap(targetGapName)
    local targetObj = GapsContainer:FindFirstChild(targetGapName)
    if not targetObj then return end
    
    local destination = targetObj.Position + Vector3.new(0, 3, 0)
    
    if not IsSafeToTeleport(destination) then
        return "DANGER"
    end

    local glideTween = TweenService:Create(RootPart, 
        TweenInfo.new(1.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), 
        {CFrame = CFrame.new(destination)}
    )
    glideTween:Play()
    return "SUCCESS"
end

--------------------------------------------------------------------------------
-- // 3. INTERFACE WindUI
--------------------------------------------------------------------------------
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

local Window = WindUI:CreateWindow({
    Title = "Nexus Prime Hub",
    Icon = "shield",
    Author = "Chief Dev",
    Folder = "NexusStudio",
    Transparent = true,
    Theme = "Dark"
})

-- [ CATEGORIA: PLAYER ]
local PlayerTab = Window:Tab({ Title = "Player", Icon = "user" })

PlayerTab:Section({ Title = "Movement Physics" })

PlayerTab:Slider({
    Title = "Walk Speed",
    Value = {Min = 16, Max = 300, Default = 16},
    Callback = function(v) 
        State.Speed = v 
        Humanoid.WalkSpeed = v
    end
})

PlayerTab:Slider({
    Title = "Jump Power",
    Value = {Min = 50, Max = 500, Default = 50},
    Callback = function(v) 
        State.Jump = v 
        Humanoid.JumpPower = v
        Humanoid.UseJumpPower = true
    end
})

PlayerTab:Toggle({
    Title = "Enable Flight (V)",
    Callback = function(bool) State.FlyEnabled = bool end
})

PlayerTab:Section({ Title = "World Interaction" })

PlayerTab:Button({
    Title = "Destroy VIP Walls",
    Desc = "Bypasses all VIP and VIP+ barriers",
    Callback = function()
        for _, wall in pairs(VIPWalls:GetChildren()) do
            wall:Destroy()
        end
        WindUI:Notify({Title = "System", Content = "VIP Barriers Decimated."})
    end
})

-- [ CATEGORIA: SELLING ]
local SellingTab = Window:Tab({ Title = "Selling", Icon = "shopping-cart" })
SellingTab:Paragraph({ Title = "Economic Module", Desc = "Configure suas opções de venda automática aqui." })

-- [ CATEGORIA: EVENTS ]
-- Icone escolhido: Lucide 'Zap' para representar eventos dinâmicos e rápidos
local EventsTab = Window:Tab({ Title = "Events", Icon = "zap" })

EventsTab:Section({ Title = "Gap Navigation System" })

EventsTab:Toggle({
    Title = "Wave Safety Protocol",
    Desc = "Prevents teleporting if a wave is near the gap",
    Value = true,
    Callback = function(bool) State.SafetyProtocol = bool end
})

local GapList = {}
for i = 1, 9 do table.insert(GapList, "Gap" .. i) end

EventsTab:Dropdown({
    Title = "Select Target Gap",
    Values = GapList,
    Callback = function(selected)
        local result = GlideToGap(selected)
        if result == "DANGER" then
            WindUI:Notify({
                Title = "ABORTED", 
                Content = "High risk of death by Wave at " .. selected, 
                Duration = 4,
                Variant = "Critical"
            })
        else
            WindUI:Notify({Title = "Navigation", Content = "Gliding to " .. selected})
        end
    end
})

-- [ CATEGORIA: SETTINGS ]
local SettingsTab = Window:Tab({ Title = "Settings", Icon = "settings" })

SettingsTab:Button({
    Title = "Uninject Script",
    Callback = function() Window:Destroy() end
})

--------------------------------------------------------------------------------
-- // 4. INICIALIZAÇÃO E HOTKEYS
--------------------------------------------------------------------------------
HandleFlight()

-- Hotkey para Voo (V)
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.V then
        State.FlyEnabled = not State.FlyEnabled
        WindUI:Notify({Title = "Flight", Content = State.FlyEnabled and "Active" or "Disabled"})
    end
end)

-- Sincronização de WalkSpeed (Burlar reset do jogo)
RunService.Stepped:Connect(function()
    if Humanoid.WalkSpeed ~= State.Speed then
        Humanoid.WalkSpeed = State.Speed
    end
end)

WindUI:Notify({
    Title = "Nexus Prime Loaded",
    Content = "Elite protocol initialized for user.",
    Icon = "check-circle"
})
